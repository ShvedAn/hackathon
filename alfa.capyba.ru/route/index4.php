<?
require($_SERVER["DOCUMENT_ROOT"]."/bitrix/header.php");
$APPLICATION->SetTitle("Маршрут");
?><!DOCTYPE html><html lang="ru-RU">
<head>
	<meta charset="UTF-8">
	<link type="text/css" media="all" href="https://bunnysketch.ru/wp-content/cache/autoptimize/css/autoptimize_21f9dca4765a9fa7cdc1d696d4443e9d.css" rel="stylesheet" />
	<title>3. Маршрут - Bunny Sketch</title>
	<meta name="robots" content="noindex,nofollow"/>
	<meta property="og:locale" content="ru_RU" />
	<meta property="og:type" content="article" />
	<meta property="og:title" content="3. Маршрут - Bunny Sketch" />
	<meta property="og:description" content="Тут должна быть карта  позвонить диспетчеру позвонить клиенту" />
	<meta property="og:url" content="https://bunnysketch.ru/3-%d0%bc%d0%b0%d1%80%d1%88%d1%80%d1%83%d1%82/" />
	<meta property="og:site_name" content="Bunny Sketch" />
	<meta property="og:image" content="https://bunnysketch.ru/wp-content/uploads/2019/06/Logo-1024x211.png" />
	<meta property="og:image:secure_url" content="https://bunnysketch.ru/wp-content/uploads/2019/06/Logo-1024x211.png" />
	<meta name="twitter:card" content="summary_large_image" />
	<meta name="twitter:description" content="Тут должна быть карта  позвонить диспетчеру позвонить клиенту" />
	<meta name="twitter:title" content="3. Маршрут - Bunny Sketch" />
	<meta name="twitter:image" content="https://bunnysketch.ru/wp-content/uploads/2019/06/Logo-1024x211.png" /> 
	<script type='application/ld+json' class='yoast-schema-graph yoast-schema-graph--main'>{"@context":"https://schema.org","@graph":[{"@type":"Organization","@id":"https://bunnysketch.ru/#organization","name":"BUNNY SKETCH - \u0441\u0442\u0443\u0434\u0438\u044f \u0434\u0438\u0437\u0430\u0439\u043d\u0430 \u0438 \u0442\u0432\u043e\u0440\u0447\u0435\u0441\u0442\u0432\u0430","url":"https://bunnysketch.ru/","sameAs":[],"logo":{"@type":"ImageObject","@id":"https://bunnysketch.ru/#logo","url":"https://bunnysketch.ru/wp-content/uploads/2019/01/Logo.png","width":1080,"height":1080,"caption":"BUNNY SKETCH - \u0441\u0442\u0443\u0434\u0438\u044f \u0434\u0438\u0437\u0430\u0439\u043d\u0430 \u0438 \u0442\u0432\u043e\u0440\u0447\u0435\u0441\u0442\u0432\u0430"},"image":{"@id":"https://bunnysketch.ru/#logo"}},{"@type":"WebSite","@id":"https://bunnysketch.ru/#website","url":"https://bunnysketch.ru/","name":"Bunny Sketch","publisher":{"@id":"https://bunnysketch.ru/#organization"},"potentialAction":{"@type":"SearchAction","target":"https://bunnysketch.ru/?s={search_term_string}","query-input":"required name=search_term_string"}},{"@type":"WebPage","@id":"https://bunnysketch.ru/3-%d0%bc%d0%b0%d1%80%d1%88%d1%80%d1%83%d1%82/#webpage","url":"https://bunnysketch.ru/3-%d0%bc%d0%b0%d1%80%d1%88%d1%80%d1%83%d1%82/","inLanguage":"ru-RU","name":"3. \u041c\u0430\u0440\u0448\u0440\u0443\u0442 - Bunny Sketch","isPartOf":{"@id":"https://bunnysketch.ru/#website"},"image":{"@type":"ImageObject","@id":"https://bunnysketch.ru/3-%d0%bc%d0%b0%d1%80%d1%88%d1%80%d1%83%d1%82/#primaryimage","url":"https://bunnysketch.ru/wp-content/uploads/2019/06/Logo.png","width":"1041","height":"214"},"primaryImageOfPage":{"@id":"https://bunnysketch.ru/3-%d0%bc%d0%b0%d1%80%d1%88%d1%80%d1%83%d1%82/#primaryimage"},"datePublished":"2019-06-30T00:23:07+00:00","dateModified":"2019-06-30T00:53:41+00:00"}]}</script> 
	<link rel='dns-prefetch' href='//s.w.org' />
	<link rel="alternate" type="application/rss+xml" title="Bunny Sketch &raquo; Лента" href="https://bunnysketch.ru/feed/" />
	<link rel="alternate" type="application/rss+xml" title="Bunny Sketch &raquo; Лента комментариев" href="https://bunnysketch.ru/comments/feed/" /> 
	<script type="text/javascript">window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/12.0.0-1\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/12.0.0-1\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/bunnysketch.ru\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.2.2"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55357,56424,55356,57342,8205,55358,56605,8205,55357,56424,55356,57340],[55357,56424,55356,57342,8203,55358,56605,8203,55357,56424,55356,57340]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);</script> 
			<link rel='stylesheet' id='elementor-global-css'  href='https://bunnysketch.ru/wp-content/cache/autoptimize/css/autoptimize_single_9efd7f6de9f61654c7581358404a0392.css?ver=1560005171' type='text/css' media='all' />
			<link rel='stylesheet' id='elementor-post-735-css'  href='https://bunnysketch.ru/wp-content/cache/autoptimize/css/autoptimize_single_1c13503801922eab472aca1657c738ed.css?ver=1561858016' type='text/css' media='all' />
			<link rel='stylesheet' id='google-fonts-1-css'  href='https://fonts.googleapis.com/css?family=Roboto%3A100%2C100italic%2C200%2C200italic%2C300%2C300italic%2C400%2C400italic%2C500%2C500italic%2C600%2C600italic%2C700%2C700italic%2C800%2C800italic%2C900%2C900italic%7CRoboto+Slab%3A100%2C100italic%2C200%2C200italic%2C300%2C300italic%2C400%2C400italic%2C500%2C500italic%2C600%2C600italic%2C700%2C700italic%2C800%2C800italic%2C900%2C900italic&#038;subset=cyrillic&#038;ver=5.2.2' type='text/css' media='all' /> 
			<!--[if IE]> <script type='text/javascript' src='https://bunnysketch.ru/wp-content/themes/astra/assets/js/minified/flexibility.min.js?ver=1.6.2'></script> <script type='text/javascript'>flexibility(document.documentElement);</script> <![endif]--> 
			<script type='text/javascript' src='https://bunnysketch.ru/wp-includes/js/jquery/jquery.js?ver=1.12.4-wp'></script> 
			<link rel='https://api.w.org/' href='https://bunnysketch.ru/wp-json/' />
			<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://bunnysketch.ru/xmlrpc.php?rsd" />
			<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://bunnysketch.ru/wp-includes/wlwmanifest.xml" />
			<meta name="generator" content="WordPress 5.2.2" /><link rel='shortlink' href='https://bunnysketch.ru/?p=735' />
			<link rel="alternate" type="application/json+oembed" href="https://bunnysketch.ru/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fbunnysketch.ru%2F3-%25d0%25bc%25d0%25b0%25d1%2580%25d1%2588%25d1%2580%25d1%2583%25d1%2582%2F" />
			<link rel="alternate" type="text/xml+oembed" href="https://bunnysketch.ru/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fbunnysketch.ru%2F3-%25d0%25bc%25d0%25b0%25d1%2580%25d1%2588%25d1%2580%25d1%2583%25d1%2582%2F&#038;format=xml" />
			<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
		</head>
		<body class="page-template page-template-elementor_canvas page page-id-735 ast-desktop ast-page-builder-template ast-no-sidebar astra-1.6.2 ast-header-custom-item-inside ast-single-post ast-mobile-inherit-site-logo ast-inherit-site-logo-transparent elementor-default elementor-template-canvas elementor-page elementor-page-735">
			<div data-elementor-type="post" data-elementor-id="735" class="elementor elementor-735" data-elementor-settings="[]">
				<div class="elementor-inner">
					<div class="elementor-section-wrap">
						<section class="elementor-element elementor-element-12d2984d elementor-section-full_width elementor-section-height-full elementor-section-items-top elementor-section-height-default elementor-section elementor-top-section" data-id="12d2984d" data-element_type="section" data-settings="{&quot;background_background&quot;:&quot;gradient&quot;}">
							<div class="elementor-background-overlay"></div>
							<div class="elementor-container elementor-column-gap-default">
								<div class="elementor-row">
									<div class="elementor-element elementor-element-5df10bd7 elementor-column elementor-col-100 elementor-top-column" data-id="5df10bd7" data-element_type="column">
										<div class="elementor-column-wrap  elementor-element-populated">
											<div class="elementor-widget-wrap">
												<section class="elementor-element elementor-element-6c27c180 elementor-section-full_width elementor-section-height-default elementor-section-height-default elementor-section elementor-inner-section" data-id="6c27c180" data-element_type="section"><div class="elementor-container elementor-column-gap-default">
													<div class="elementor-row">
														<div class="elementor-element elementor-element-5714a303 elementor-column elementor-col-100 elementor-inner-column" data-id="5714a303" data-element_type="column">
															<div class="elementor-column-wrap  elementor-element-populated">
																<div class="elementor-widget-wrap">
																	<div class="elementor-element elementor-element-3b987a0f elementor-widget elementor-widget-image" data-id="3b987a0f" data-element_type="widget" data-widget_type="image.default">
																		<div class="elementor-widget-container">
																			<div class="elementor-image"> 
																				<img width="1024" height="211" src="https://bunnysketch.ru/wp-content/uploads/2019/06/Logo-1024x211.png" class="attachment-large size-large" alt="" srcset="https://bunnysketch.ru/wp-content/uploads/2019/06/Logo-1024x211.png 1024w, https://bunnysketch.ru/wp-content/uploads/2019/06/Logo-300x62.png 300w, https://bunnysketch.ru/wp-content/uploads/2019/06/Logo-768x158.png 768w, https://bunnysketch.ru/wp-content/uploads/2019/06/Logo.png 1041w" sizes="(max-width: 1024px) 100vw, 1024px" />
																			</div>
																		</div>
																	</div>
																</div>
															</div>
														</div>
													</div>
												</div>
											</section>
											<section class="elementor-element elementor-element-caa4b6d elementor-section-boxed elementor-section-height-default elementor-section-height-default elementor-section elementor-inner-section" data-id="caa4b6d" data-element_type="section">
												<div class="elementor-container elementor-column-gap-default">
													<div class="elementor-row">
														<div class="elementor-element elementor-element-09a9ff5 elementor-column elementor-col-100 elementor-inner-column" data-id="09a9ff5" data-element_type="column">
															<div class="elementor-column-wrap  elementor-element-populated">
																<div class="elementor-widget-wrap">
																	<div class="elementor-element elementor-element-d91d641 elementor-widget elementor-widget-text-editor" data-id="d91d641" data-element_type="widget" data-widget_type="text-editor.default">
																		<div class="elementor-widget-container">
																			<div class="elementor-text-editor elementor-clearfix">
<pre>
<?
CModule::IncludeModule("iblock");
$arSelect = Array("ID", "IBLOCK_ID", "NAME", "DATE_ACTIVE_FROM","PROPERTY_*");
$arFilter = Array("IBLOCK_ID"=>1,  "ACTIVE"=>"Y");
$res = CIBlockElement::GetList(Array(), $arFilter, false, Array("nPageSize"=>50), $arSelect);
$position = array();
while($ob = $res->GetNextElement()){ 
 //$arFields = $ob->GetFields();  
//print_r($arFields);
 $arProps = $ob->GetProperties();
//var_dump($arProps);
//var_dump($arProps['COORDINATE']['VALUE']);
$position[] = $arProps['COORDINATE']['VALUE'];
}
// var_dump($position);

include_once '../api/routing.php';
//$res = routing($position);
//var_dump($res);
$res = array(
"53.269080649966,50.475419674652",
"53.311714397477,50.249023869141",
"53.227300814833,50.255890324219",
"53.213443460737,50.182247593506",
"53.134076268877,50.069122746094",
);


// Активация нового заказа на карте
if ($_REQUEST['test'] != '') {
	$obEl = new CIBlockElement();
	$boolResult = $obEl->Update(9,array('ACTIVE' => 'Y'));
	header('Location: https://alfa.capyba.ru/route/index.php');
}



$cor = '';
foreach($res as $val){
	$cor .= '['.$val.'],';
}
//var_dump($cor);

?> 
</pre>





<script type="text/javascript">

</script>

<script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU" type="text/javascript"></script>
<!-- <div id="map" style="width:450px;height:300px"></div> -->
<div id="map" style="width:100%;height:500px"></div>


<script type="text/javascript">



ymaps.ready(function () {
    var myMap = new ymaps.Map('map', {
        center: [53.22076683693211, 50.21076855293934],
                // center: [],
        zoom: 9,
        controls: []
    });
 //unshift(0);
var m = [
<?=$cor?>
 
// [53.269080649966,50.475419674652],
// [53.311714397477,50.249023869141],
// [53.227300814833,50.255890324219],
// [53.213443460737,50.182247593506],
// [53.134076268877,50.069122746094],
        ];
        // alert();
        if(window.location.href == 'https://alfa.capyba.ru/route/index.php?day=1'){
        	if(navigator.geolocation) {
navigator.geolocation.getCurrentPosition(function(position) {
            var latitude = position.coords.latitude;
            var longitude = position.coords.longitude;
			//alert(latitude+' '+longitude);
        	
        	//m.unshift(latitude+','+longitude);
});
 m.unshift('53.22076683693211, 50.21076855293934');
 
} else {
   // alert("Geolocation API не поддерживается в вашем браузере");
}
        	
        }
        

    // Создание экземпляра маршрута.
    var multiRoute = new ymaps.multiRouter.MultiRoute({   
        // Точки маршрута.
        // Обязательное поле. 
        referencePoints: m
    }, {
      // Автоматически устанавливать границы карты так,
      // чтобы маршрут был виден целиком.
      boundsAutoApply: true
});

    // Добавление маршрута на карту.
    myMap.geoObjects.add(multiRoute);
});
</script>

<script type="text/javascript">





// оптимальный
 // [0]=>
 //  string(31) "53.269080649966,50.475419674652"
 //  [1]=>
 //  string(31) "53.311714397477,50.249023869141"
 //  [2]=>
 //  string(31) "53.227300814833,50.255890324219"
 //  [3]=>
 //  string(31) "53.213443460737,50.182247593506"
 //  [4]=>
 //  string(31) "53.134076268877,50.069122746094"



</script>
																			</div>
																		</div>
																	</div>
																</div>
															</div>
														</div>
													</div>
												</div>
											</section>
											<section class="elementor-element elementor-element-1f08ebf elementor-section-boxed elementor-section-height-default elementor-section-height-default elementor-section elementor-inner-section" data-id="1f08ebf" data-element_type="section">
												<div class="elementor-container elementor-column-gap-default">
													<div class="elementor-row">
														<div class="elementor-element elementor-element-8fbe231 elementor-hidden-tablet elementor-hidden-phone elementor-column elementor-col-33 elementor-inner-column" data-id="8fbe231" data-element_type="column">
															<div class="elementor-column-wrap  elementor-element-populated">
																<div class="elementor-widget-wrap">
																	<div class="elementor-element elementor-element-47567b2 elementor-widget elementor-widget-image" data-id="47567b2" data-element_type="widget" data-widget_type="image.default">
																		<div class="elementor-widget-container">
																			<div class="elementor-image"> 
																				<a href="/lk/"><img width="388" height="384" src="https://bunnysketch.ru/wp-content/uploads/2019/06/Назад.png" class="attachment-large size-large" alt="" srcset="https://bunnysketch.ru/wp-content/uploads/2019/06/Назад.png 388w, https://bunnysketch.ru/wp-content/uploads/2019/06/Назад-300x297.png 300w" sizes="(max-width: 388px) 100vw, 388px" /></a>
																			</div>
																		</div>
																	</div>
																</div>
															</div>
														</div>
														<div class="elementor-element elementor-element-5e5c6d6 elementor-column elementor-col-33 elementor-inner-column" data-id="5e5c6d6" data-element_type="column">
															<div class="elementor-column-wrap  elementor-element-populated">
																<div class="elementor-widget-wrap">
																	<div class="elementor-element elementor-element-f01393f elementor-align-center elementor-widget elementor-widget-button" data-id="f01393f" data-element_type="widget" data-widget_type="button.default">
																		<div class="elementor-widget-container">
																			<div class="elementor-button-wrapper"> 
																				<a href="tel:+79270262464" class="elementor-button-link elementor-button elementor-size-sm elementor-animation-shrink" role="button"> 
																					<span class="elementor-button-content-wrapper"> 
																						<span class="elementor-button-text">позвонить диспетчеру</span> 
																					</span> 

																				</a>
																						<a href="/route/index.php?test=1" class="elementor-button-link elementor-button elementor-size-sm elementor-animation-shrink" role="button"> 
																					<span class="elementor-button-content-wrapper"> 
																						<span class="elementor-button-text">Создать новый заказ</span> 
																					</span> 
																					
																				</a>
																			</div>
																		</div>
																	</div>
																</div>
															</div>
														</div>
														<div class="elementor-element elementor-element-9bd1588 elementor-column elementor-col-33 elementor-inner-column" data-id="9bd1588" data-element_type="column"><div class="elementor-column-wrap  elementor-element-populated"><div class="elementor-widget-wrap"><div class="elementor-element elementor-element-e7e2475 elementor-align-center elementor-widget elementor-widget-button" data-id="e7e2475" data-element_type="widget" data-widget_type="button.default"><div class="elementor-widget-container"><div class="elementor-button-wrapper"> <a href="tel:+79270262464" class="elementor-button-link elementor-button elementor-size-sm elementor-animation-shrink" role="button"> <span class="elementor-button-content-wrapper"> <span class="elementor-button-text">позвонить первому клиенту</span> </span> </a></div></div></div></div></div></div></div></div></section></div></div></div></div></div></section></div></div></div> <script type='text/javascript'>var astra = {"break_point":"921","isRtl":""};</script> <script type='text/javascript'>var wpcf7 = {"apiSettings":{"root":"https:\/\/bunnysketch.ru\/wp-json\/contact-form-7\/v1","namespace":"contact-form-7\/v1"}};</script> <script type='text/javascript'>var ElementorProFrontendConfig = {"ajaxurl":"https:\/\/bunnysketch.ru\/wp-admin\/admin-ajax.php","nonce":"aeb1c29609","shareButtonsNetworks":{"facebook":{"title":"Facebook","has_counter":true},"twitter":{"title":"Twitter"},"google":{"title":"Google+","has_counter":true},"linkedin":{"title":"LinkedIn","has_counter":true},"pinterest":{"title":"Pinterest","has_counter":true},"reddit":{"title":"Reddit","has_counter":true},"vk":{"title":"VK","has_counter":true},"odnoklassniki":{"title":"OK","has_counter":true},"tumblr":{"title":"Tumblr"},"delicious":{"title":"Delicious"},"digg":{"title":"Digg"},"skype":{"title":"Skype"},"stumbleupon":{"title":"StumbleUpon","has_counter":true},"telegram":{"title":"Telegram"},"pocket":{"title":"Pocket","has_counter":true},"xing":{"title":"XING","has_counter":true},"whatsapp":{"title":"WhatsApp"},"email":{"title":"Email"},"print":{"title":"Print"}},"facebook_sdk":{"lang":"ru_RU","app_id":""}};</script> <script type='text/javascript'>var elementorFrontendConfig = {"environmentMode":{"edit":false,"wpPreview":false},"is_rtl":false,"breakpoints":{"xs":0,"sm":480,"md":768,"lg":1025,"xl":1440,"xxl":1600},"version":"2.5.16","urls":{"assets":"https:\/\/bunnysketch.ru\/wp-content\/plugins\/elementor\/assets\/"},"settings":{"page":[],"general":{"elementor_global_image_lightbox":"yes","elementor_enable_lightbox_in_editor":"yes"}},"post":{"id":735,"title":"3. \u041c\u0430\u0440\u0448\u0440\u0443\u0442","excerpt":""}};</script> <script type='text/javascript'>var jetElements = {"ajaxUrl":"https:\/\/bunnysketch.ru\/wp-admin\/admin-ajax.php","messages":{"invalidMail":"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u043e\u0431\u043e\u0437\u043d\u0430\u0447\u044c\u0442\u0435 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0439 email"}};</script> <script type="text/javascript" defer src="https://bunnysketch.ru/wp-content/cache/autoptimize/js/autoptimize_63b0ac7ede252b19eaa52d1a82b10f4d.js"></script></body></html>